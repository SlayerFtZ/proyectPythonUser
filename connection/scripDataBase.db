-- Create the database
CREATE DATABASE DB_SazonIa;
USE DB_SazonIa;

-- Create the User table
CREATE TABLE User (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name_father VARCHAR(50) NOT NULL,
    last_name_mother VARCHAR(50) NOT NULL,
    birth_date DATE NOT NULL,
    phone_number VARCHAR(15) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL
);
CREATE TABLE ProfilePicture (
    picture_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    mongo_image_id VARCHAR(255) NOT NULL, -- Almacena el ID de la imagen de MongoDB
    upload_time DATETIME NOT NULL,
    CONSTRAINT FK_ProfilePicture_User FOREIGN KEY (user_id) REFERENCES User(user_id)
);
-- Create the Profession table
CREATE TABLE Profession (
    profession_id INT AUTO_INCREMENT PRIMARY KEY,
    profession VARCHAR(100) NOT NULL
);

-- Create the ChefLicense table with foreign keys to User and Profession
CREATE TABLE ChefLicense (
    ChefLicense_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    profession_id INT,
    license VARCHAR(50) NOT NULL,
    gender VARCHAR(10),
    profession VARCHAR(100),
    year_of_issue YEAR,
    institution VARCHAR(100),
    CONSTRAINT FK_ChefLicense_User FOREIGN KEY (user_id) REFERENCES User(user_id),
    CONSTRAINT FK_ChefLicense_Profession FOREIGN KEY (profession_id) REFERENCES Profession(profession_id)
);

-- Create the Token table with a foreign key to User
CREATE TABLE Token (
    token_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    reset_token VARCHAR(255),
    token_expiration DATETIME,
    CONSTRAINT FK_Token_User FOREIGN KEY (user_id) REFERENCES User(user_id)
);

-- Create an index on the profession field in ChefLicense
CREATE INDEX idx_profession ON ChefLicense (profession);

-- Create a unique index on the reset_token field
CREATE UNIQUE INDEX idx_reset_token ON Token (reset_token);

-- Queries
SELECT * FROM User;
SELECT * FROM ProfilePicture;
SELECT * FROM ChefLicense;
SELECT * FROM Profession;
SELECT * FROM Token;

-- Drop the database (optional, not recommended in development)
DROP DATABASE DB_SazonIa;
DROP TABLE User;
DROP TABLE ChefLicense;
DROP TABLE Profession;
DROP TABLE Token;
