-- Create the database
CREATE DATABASE DB_SazonIa;
USE DB_SazonIa;

-- Create the Users table
CREATE TABLE Users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name_father VARCHAR(50) NOT NULL,
    last_name_mother VARCHAR(50) NOT NULL,
    birth_date DATE NOT NULL,
    phone_number VARCHAR(15) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL
);

-- Create the Profession table
CREATE TABLE Profession (
    profession_id INT AUTO_INCREMENT PRIMARY KEY,
    profession VARCHAR(100) NOT NULL
);

-- Create the ChefLicenses table with foreign keys to Users and Profession
CREATE TABLE ChefLicenses (
    ChefLicenses_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    profession_id INT,
    license VARCHAR(50) NOT NULL,
    gender VARCHAR(10),
    profession VARCHAR(100),
    year_of_issue YEAR,
    institution VARCHAR(100),
    CONSTRAINT FK_ChefLicenses_Users FOREIGN KEY (user_id) REFERENCES Users(user_id),
    CONSTRAINT FK_ChefLicenses_Profession FOREIGN KEY (profession_id) REFERENCES Profession(profession_id)
);

-- Create the Tokens table with a foreign key to Users
CREATE TABLE Tokens (
    token_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    reset_token VARCHAR(255),
    token_expiration DATETIME,
    CONSTRAINT FK_Tokens_Users FOREIGN KEY (user_id) REFERENCES Users(user_id)
);

-- Create an index on the profession field in ChefLicenses
CREATE INDEX idx_profession ON ChefLicenses (profession);

-- Create a unique index on the reset_token field
CREATE UNIQUE INDEX idx_reset_token ON Tokens (reset_token);

-- Queries
SELECT * FROM Users;
SELECT * FROM ChefLicenses;
SELECT * FROM Profession;
SELECT * FROM Tokens;

-- Drop the database (optional, not recommended in development)
DROP DATABASE DB_SazonIa;
DROP TABLE Users;
DROP TABLE ChefLicenses;
DROP TABLE Profession;
DROP TABLE Tokens;
